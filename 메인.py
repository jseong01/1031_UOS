# app.py
# ============================================
# ì„œìš¸ ì´ì‚¬ ë§Œì¡±ë„ ì¶”ì²œ (ì§‘ê°’ í‹°ì–´ ë¯¸ë¦¬ ì •ì˜ + ì„¤ë¬¸ 14ë¬¸í•­)
# ============================================
import streamlit as st
import pandas as pd
import numpy as np
from pathlib import Path



# ============================================
# app.py ìƒë‹¨
# ============================================
import streamlit as st
import pandas as pd
import numpy as np
from pathlib import Path

# --- í˜ì´ì§€ ì„¤ì • ---
# ============================================
# app.py ìƒë‹¨ (íƒ€ì´í‹€ + ë¡œê³  + ë¶€ì œ ë””ìì¸)
# ============================================
import streamlit as st
import pandas as pd
import numpy as np
from pathlib import Path

# --- í˜ì´ì§€ ì„¤ì • ---
# ============================================
# app.py ìƒë‹¨ (íƒ€ì´í‹€ + ë¡œê³  + ë¶€ì œ ë””ìì¸)
# ============================================
import streamlit as st
import pandas as pd
import numpy as np
from pathlib import Path

# --- í˜ì´ì§€ ì„¤ì • ---
st.set_page_config(
    page_title="ì„œìš¸ì‹œ ë§ì¶¤í˜• ë™ë„¤ ì¶”ì²œ â€” ë‹¹ì‹ ì˜ ë¼ì´í”„ìŠ¤íƒ€ì¼ì„ ë°˜ì˜í•©ë‹ˆë‹¤",
    page_icon="ğŸŒ†",
    layout="wide"
)

# --- ë¡œê³  íŒŒì¼ ê²½ë¡œ ---
LOGO_DIR = Path("C:/Users/user/Desktop/streamlit/logos")
logo_seoul = LOGO_DIR / "ì„œìš¸ì‹œ.jpeg"
logo_uos = LOGO_DIR / "ì„œìš¸ì‹œë¦½ëŒ€.png"

# --- ìƒë‹¨ ë ˆì´ì•„ì›ƒ (ì¢Œ: ì„œìš¸ì‹œ / ì¤‘: íƒ€ì´í‹€ / ìš°: ì„œìš¸ì‹œë¦½ëŒ€) ---
cols = st.columns([1, 3, 1])

with cols[0]:
    if logo_seoul.exists():
        st.image(str(logo_seoul), width=200)
    else:
        st.markdown("ğŸ™ï¸")

with cols[1]:
    st.markdown(
        """
        <div style='text-align:center; line-height:1.4;'>
            <h1 style='margin-bottom:0;'> ì„œìš¸ì‹œ ë§ì¶¤í˜• ë™ë„¤ ì¶”ì²œ</h1>
            <h4 style='color:#5a5a5a; margin-top:0.3em; font-weight:400;'>
                <em>Seoul Lifestyle Matching System</em>
            </h4>
            <p style='color:gray; margin-top:0.4em; font-size:16px;'>
                ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ <b>ë‹¹ì‹ ì˜ ìƒí™œí™˜ê²½ ì„ í˜¸ë„</b>ì— ê¼­ ë§ëŠ” ë™ë„¤ë¥¼ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤.
            </p>
        </div>
        """,
        unsafe_allow_html=True
    )

with cols[2]:
    if logo_uos.exists():
        st.image(str(logo_uos), width=200)
    else:
        st.markdown("ğŸ“")

st.markdown("---")  # êµ¬ë¶„ì„ 



# --- ë°ì´í„° ê²½ë¡œ ---
DATA_DIR = Path("C:/Users/user/Desktop/streamlit")
C_FILE = DATA_DIR / "ì¤‘ìš”ë„ ì •ê·œí™”.csv"

# --- â‘  ì£¼íƒë§¤ë§¤ì§€ìˆ˜ í‹°ì–´ (í•˜ë“œì½”ë”©) ---
tier_data = {
    "ê°•ë‚¨êµ¬": "ìƒ", "ê°•ë™êµ¬": "ì¤‘", "ê°•ë¶êµ¬": "í•˜", "ê°•ì„œêµ¬": "í•˜", "ê´€ì•…êµ¬": "í•˜",
    "ê´‘ì§„êµ¬": "ìƒ", "êµ¬ë¡œêµ¬": "í•˜", "ê¸ˆì²œêµ¬": "í•˜", "ë…¸ì›êµ¬": "í•˜", "ë„ë´‰êµ¬": "í•˜",
    "ë™ëŒ€ë¬¸êµ¬": "ì¤‘", "ë™ì‘êµ¬": "ìƒ", "ë§ˆí¬êµ¬": "ì¤‘", "ì„œëŒ€ë¬¸êµ¬": "ì¤‘", "ì„œì´ˆêµ¬": "ìƒ",
    "ì„±ë™êµ¬": "ì¤‘", "ì„±ë¶êµ¬": "í•˜", "ì†¡íŒŒêµ¬": "ìƒ", "ì–‘ì²œêµ¬": "ìƒ", "ì˜ë“±í¬êµ¬": "ì¤‘",
    "ìš©ì‚°êµ¬": "ìƒ", "ì€í‰êµ¬": "ì¤‘", "ì¢…ë¡œêµ¬": "ìƒ", "ì¤‘êµ¬": "ì¤‘", "ì¤‘ë‘êµ¬": "ì¤‘"
}

# --- â‘¡ ë³€ìˆ˜ ë° ì§ˆë¬¸ ì •ì˜ ---
VARS = [
    "êµí†µì´ìš©ë§Œì¡±ë„_í‰ê· ","ë³´í–‰í™˜ê²½ë§Œì¡±ë„_ì£¼ê±°ì§€ì—­","ë…¹ì§€í˜„í™©(ê°œì†Œ)","ìƒìˆ˜ë„ìš”ê¸ˆí‰ë‹¨",
    "êµ¬ë³„ ì˜ë£Œê¸°ê´€ ìˆ˜","ë…¸ì¸ì—¬ê°€ë³µì§€ì‹œì„¤ ê°œìˆ˜","ë„ì‹œ ìœ„í—˜ë„","êµ¬ë³„ ì§€ë°©ì„¸ ì§•ìˆ˜ì•¡",
    "êµ¬ë³„ ì£¼íƒë§¤ë§¤ì§€ìˆ˜","ë³´ìœ¡ì‹œì„¤ì´ìš©ë¥ ",
    "êµ¬ë³„ ì´ˆë“±í•™êµ êµì› 1ì¸ë‹¹ í•™ìƒ ìˆ˜","êµ¬ë³„ ì¤‘í•™êµ êµì› 1ì¸ë‹¹ í•™ìƒ ìˆ˜",
    "êµ¬ë³„ ê³ ë“±í•™êµ êµì› 1ì¸ë‹¹ í•™ìƒìˆ˜","êµ¬ë³„ ìœ ì¹˜ì› êµì› 1ì¸ë‹¹ í•™ìƒ ìˆ˜",
]

QUESTIONS = {
    "êµí†µì´ìš©ë§Œì¡±ë„_í‰ê· ": "êµí†µ ì´ìš© í¸ì˜ì„±(ëŒ€ì¤‘êµí†µ ì ‘ê·¼/ì •ì‹œì„±)",
    "ë³´í–‰í™˜ê²½ë§Œì¡±ë„_ì£¼ê±°ì§€ì—­": "ë³´í–‰í™˜ê²½(ë³´ë„ ì•ˆì „/ì¾Œì ì„±)",
    "ë…¹ì§€í˜„í™©(ê°œì†Œ)": "ê³µì›/ë…¹ì§€ ì ‘ê·¼ì„±",
    "ìƒìˆ˜ë„ìš”ê¸ˆí‰ë‹¨": "ìƒìˆ˜ë„ ìš”ê¸ˆ ë¶€ë‹´",
    "êµ¬ë³„ ì˜ë£Œê¸°ê´€ ìˆ˜": "ì˜ë£Œ ì ‘ê·¼ì„±(ë³‘ì›/ì˜ì› ìˆ˜)",
    "ë…¸ì¸ì—¬ê°€ë³µì§€ì‹œì„¤ ê°œìˆ˜": "ë…¸ì¸ ì—¬ê°€/ë³µì§€ ì¸í”„ë¼",
    "ë„ì‹œ ìœ„í—˜ë„": "ë„ì‹œ ì•ˆì „(ìœ„í—˜ ë‚®ìŒ)",
    "êµ¬ë³„ ì§€ë°©ì„¸ ì§•ìˆ˜ì•¡": "ì¬ì • ì—¬ë ¥(ì„¸ìˆ˜/ì„œë¹„ìŠ¤)",
    "êµ¬ë³„ ì£¼íƒë§¤ë§¤ì§€ìˆ˜": "ì£¼íƒì‹œì¥ ì•ˆì •ì„±(ê°€ê²© ìˆ˜ì¤€/ë³€ë™)",
    "ë³´ìœ¡ì‹œì„¤ì´ìš©ë¥ ": "ë³´ìœ¡ ì¸í”„ë¼ ì¶©ì¡±ë„",
    "êµ¬ë³„ ì´ˆë“±í•™êµ êµì› 1ì¸ë‹¹ í•™ìƒ ìˆ˜": "ì´ˆë“±í•™êµ í•™ê¸‰ ë°€ë„",
    "êµ¬ë³„ ì¤‘í•™êµ êµì› 1ì¸ë‹¹ í•™ìƒ ìˆ˜": "ì¤‘í•™êµ í•™ê¸‰ ë°€ë„",
    "êµ¬ë³„ ê³ ë“±í•™êµ êµì› 1ì¸ë‹¹ í•™ìƒìˆ˜": "ê³ ë“±í•™êµ í•™ê¸‰ ë°€ë„",
    "êµ¬ë³„ ìœ ì¹˜ì› êµì› 1ì¸ë‹¹ í•™ìƒ ìˆ˜": "ìœ ì¹˜ì› í•™ê¸‰ ë°€ë„",
}

# --- â‘¢ ì˜í–¥ì§€ìˆ˜ ë¶ˆëŸ¬ì˜¤ê¸° ---
@st.cache_data(show_spinner=False)
def load_influence(path: Path) -> pd.DataFrame:
    df = pd.read_csv(path, index_col=0)
    for v in VARS:
        if v not in df.columns:
            raise ValueError(f"ì˜í–¥ì§€ìˆ˜ íŒŒì¼ì— ëˆ„ë½ëœ ë³€ìˆ˜: {v}")
    return df[VARS].astype(float)

if not C_FILE.exists():
    st.error(f"âš ï¸ ì˜í–¥ì§€ìˆ˜ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤: {C_FILE}")
    st.stop()

C_norm = load_influence(C_FILE)

# --- â‘£ í‹°ì–´ ì„ íƒ ---
st.sidebar.header("ğŸ  ì§‘ê°’ ìˆ˜ì¤€ ì„ íƒ")
selected_tier = st.sidebar.selectbox("ì§‘ê°’ ìˆ˜ì¤€ ì„ íƒ", ["ìƒ", "ì¤‘", "í•˜"], index=1)
allowed = [gu for gu, tier in tier_data.items() if tier == selected_tier]
C_sub = C_norm.loc[C_norm.index.intersection(allowed)]

# --- â‘¤ ì‚¬ìš©ì ì…ë ¥ (14ë¬¸í•­) ---
st.markdown("ìƒí™œí™˜ê²½ ìš”ì†Œì— ëŒ€í•´ ì¤‘ìš”ë„ë¥¼ ì…ë ¥í•˜ì„¸ìš” (1ï¸âƒ£: ì „í˜€ ì¤‘ìš”í•˜ì§€ ì•ŠìŒ  ~ 5ï¸âƒ£ :ë§¤ìš° ì¤‘ìš”)")

cols = st.columns(2)
w_user = {}
for i, var in enumerate(VARS):
    col = cols[i % 2]
    val = col.slider(f"{i+1}. {QUESTIONS[var]}", 1, 5, 3, 1)
    w_user[var] = (val - 1.0) / 4.0  # 0~1ë¡œ ë³€í™˜

w = pd.Series(w_user, index=VARS)
if w.sum() > 0:
    w = w / w.sum()

# --- â‘¥ ì ìˆ˜ ê³„ì‚° (ì •ê·œí™” ì˜í–¥ì§€ìˆ˜ Ã— ì¤‘ìš”ë„) ---
score = (C_sub * w).sum(axis=1)
rank = score.sort_values(ascending=False).to_frame("ì˜ˆìƒ ë§Œì¡±ë„ ì ìˆ˜")

# --- â‘¦ ê²°ê³¼ í‘œì‹œ ---
# --- â‘¦ ê²°ê³¼ í‘œì‹œ (ë¡œê³  + ë§í¬ + ì„¤ëª… ì¹´ë“œ) ---
from pathlib import Path
import os

LOGO_DIR = Path("C:/Users/user/Desktop/streamlit/logos")

gu_info = {
    "ê°•ë‚¨êµ¬": ("https://www.gangnam.go.kr", "ì„œìš¸ì˜ ê²½ì œÂ·ë¬¸í™” ì¤‘ì‹¬, ë†’ì€ ìƒí™œ ì¸í”„ë¼"),
    "ê°•ë™êµ¬": ("https://www.gangdong.go.kr", "ì¾Œì í•œ ì£¼ê±°í™˜ê²½ê³¼ í•œê°•ë³€ ë…¹ì§€ ì¡°ì„±"),
    "ê°•ë¶êµ¬": ("https://www.gangbuk.go.kr", "ë¶í•œì‚° ìë½ì˜ ìì—° ì¹œí™”ì  ë„ì‹œ"),
    "ê°•ì„œêµ¬": ("https://www.gangseo.seoul.kr", "ê¹€í¬ê³µí•­ ì¸ì ‘, ì„œë‚¨ê¶Œ ê´€ë¬¸ë„ì‹œ"),
    "ê´€ì•…êµ¬": ("https://www.gwanak.go.kr", "ëŒ€í•™ê°€ ì¤‘ì‹¬ì˜ ì Šì€ ë¶„ìœ„ê¸°ì™€ ë¬¸í™”"),
    "ê´‘ì§„êµ¬": ("https://www.gwangjin.go.kr", "ê±´ëŒ€ì…êµ¬ ì¤‘ì‹¬ì˜ ìƒê¶ŒÂ·ë¬¸í™” ì¤‘ì‹¬ì§€"),
    "êµ¬ë¡œêµ¬": ("https://www.guro.go.kr", "ITì‚°ì—…ë‹¨ì§€ì™€ ë‚¨ë¶€ ìƒí™œê±°ì "),
    "ê¸ˆì²œêµ¬": ("https://www.geumcheon.go.kr", "ì²¨ë‹¨ì‚°ì—… ì¤‘ì‹¬ì˜ ë„ì‹¬í˜• ìì¡±ë„ì‹œ"),
    "ë…¸ì›êµ¬": ("https://www.nowon.kr", "ë¶ë¶€ ì£¼ê±° ì¤‘ì‹¬ì§€, êµìœ¡í™˜ê²½ ìš°ìˆ˜"),
    "ë„ë´‰êµ¬": ("https://www.dobong.go.kr", "ìì—°ê³¼ ì¡°í™”ëœ ì¡°ìš©í•œ ì£¼ê±°ì§€ì—­"),
    "ë™ëŒ€ë¬¸êµ¬": ("https://www.ddm.go.kr", "íŒ¨ì…˜ê³¼ ìƒì—… ì¤‘ì‹¬, êµí†µ ì ‘ê·¼ì„± ìš°ìˆ˜"),
    "ë™ì‘êµ¬": ("https://www.dongjak.go.kr", "í•œê°•ë³€ ì£¼ê±°Â·êµìœ¡ í™˜ê²½ ìš°ìˆ˜"),
    "ë§ˆí¬êµ¬": ("https://www.mapo.go.kr", "í™ëŒ€Â·ìƒìˆ˜ ì¤‘ì‹¬ì˜ ì Šì€ ë¬¸í™” ì¤‘ì‹¬ì§€"),
    "ì„œëŒ€ë¬¸êµ¬": ("https://www.sdm.go.kr", "ì—°ì„¸ëŒ€Â·ì´í™”ì—¬ëŒ€ ë“± í•™ë¬¸ ì¤‘ì‹¬ì§€"),
    "ì„œì´ˆêµ¬": ("https://www.seocho.go.kr", "ì˜ˆìˆ ì˜ì „ë‹¹Â·êµìœ¡ ì¤‘ì‹¬ì˜ ê³ ê¸‰ ì£¼ê±°ì§€"),
    "ì„±ë™êµ¬": ("https://www.sd.go.kr", "ì„±ìˆ˜Â·ì™•ì‹­ë¦¬ ê°œë°œë¡œ ê¸‰ë¶€ìƒí•œ ì§€ì—­"),
    "ì„±ë¶êµ¬": ("https://www.sb.go.kr", "ê³ ë ¤ëŒ€Â·ì„±ì‹ ì—¬ëŒ€ ë“± êµìœ¡Â·ë¬¸í™” ì¤‘ì‹¬"),
    "ì†¡íŒŒêµ¬": ("https://www.songpa.go.kr", "ì ì‹¤ ì¤‘ì‹¬ì˜ ì£¼ê±°Â·ìƒì—… ë³µí•©ì§€ì—­, í¸ë¦¬í•œ êµí†µë§"),
    "ì–‘ì²œêµ¬": ("https://www.yangcheon.go.kr", "ëª©ë™ ì¤‘ì‹¬ì˜ êµìœ¡íŠ¹í™”Â·ì¾Œì  ì£¼ê±°ì§€"),
    "ì˜ë“±í¬êµ¬": ("https://www.ydp.go.kr", "ì—¬ì˜ë„ ê¸ˆìœµÂ·ë¹„ì¦ˆë‹ˆìŠ¤ ì¤‘ì‹¬ì§€"),
    "ìš©ì‚°êµ¬": ("https://www.yongsan.go.kr", "í•œê°•ë³€ êµ­ì œì—…ë¬´ì§€êµ¬ë¡œ ë°œì „ ì¤‘"),
    "ì€í‰êµ¬": ("https://www.ep.go.kr", "ë¶ì„œë¶€ êµí†µ ìš”ì¶©ì§€, ìì—° ì¹œí™”ì "),
    "ì¢…ë¡œêµ¬": ("https://www.jongno.go.kr", "ì„œìš¸ì˜ ì—­ì‚¬Â·í–‰ì • ì¤‘ì‹¬ì§€"),
    "ì¤‘êµ¬": ("https://www.junggu.seoul.kr", "ë„ì‹¬ ìƒì—… ì¤‘ì‹¬, ì ‘ê·¼ì„± ìµœìƒ"),
    "ì¤‘ë‘êµ¬": ("https://www.jungnang.seoul.kr", "ë™ë¶ê¶Œ ì£¼ê±°ì§€, ì„œìš¸ ì™¸ê³½ ì ‘ê·¼ ìš©ì´")
}

st.subheader("ğŸ† ì¶”ì²œ TOP 3 ìì¹˜êµ¬")

top3 = rank.head(3).index

for i, gu in enumerate(top3, start=1):
    url, desc = gu_info.get(gu, ("#", "ì •ë³´ ì—†ìŒ"))
    logo_path = LOGO_DIR / f"{gu}.png"

    # ì¹´ë“œ ì¶œë ¥ (ë¡œê³  í¬í•¨)
    cols = st.columns([1, 5])
    with cols[0]:
        if logo_path.exists():
            st.image(str(logo_path), width=80)
        else:
            st.markdown("ğŸ—ºï¸")
    with cols[1]:
        st.markdown(f"""
        <div style="margin-top:-10px">
        <h4>ğŸ… {i}ìœ„ : {gu}</h4>
        <p><a href="{url}" target="_blank">ğŸ”— {url}</a></p>
        <p style="color:gray;">{desc}</p>
        </div>
        """, unsafe_allow_html=True)

    st.markdown("---")


